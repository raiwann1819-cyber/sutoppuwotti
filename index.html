<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒˆãƒƒãƒ—ã‚¦ã‚©ãƒƒãƒã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
      background-color: #e0e0e0;
      color: #333;
    }

    button {
      font-size: 24px;
      padding: 10px 30px;
      margin: 10px;
      background-color: #cccccc;
      border: none;
      border-radius: 8px;
      color: #222;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #bbbbbb;
    }

    #time {
      font-size: 48px;
      margin: 20px;
      color: #111;
    }

    #countdown {
      font-size: 36px;
      color: #d33;
    }

    #history {
      margin-top: 30px;
      text-align: left;
      display: inline-block;
      background-color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    #toTop {
      display: none;
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 18px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background-color: #aaa;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>ã‚¹ãƒˆãƒƒãƒ—ã‚²ãƒ¼ãƒ </h1>

  <div id="modeSelect">
    <p>ç›®æ¨™æ™‚é–“ã‚’é¸ã‚“ã§ã­ï¼</p>
    <button onclick="selectTarget(5)">5ç§’</button>
    <button onclick="selectTarget(10)">10ç§’</button>
  </div>

  <div id="displaySelect" style="display:none;">
    <p>ã‚¿ã‚¤ãƒãƒ¼ã®è¡¨ç¤ºæ–¹æ³•ã‚’é¸ã‚“ã§ã­ï¼</p>
    <button onclick="selectDisplayMode(true)">ç§’æ•°ã‚’è¡¨ç¤º</button>
    <button onclick="selectDisplayMode(false)">ç§’æ•°ã‚’éš ã™</button>
  </div>

  <div id="gameArea" style="display:none;">
    <h2 id="targetLabel"></h2>
    <div id="countdown"></div>
    <div id="time">0.00</div>
    <button id="start">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
    <button id="stop" disabled>ã‚¹ãƒˆãƒƒãƒ—</button>
    <div id="result"></div>
    <div id="best">ãƒ™ã‚¹ãƒˆè¨˜éŒ²: ãªã—</div>
    <div id="history">
      <h3>è¨˜éŒ²å±¥æ­´ï¼ˆæœ€æ–°10ä»¶ï¼‰</h3>
      <ul id="historyList"></ul>
    </div>
  </div>

  <button id="toTop" onclick="scrollToTop()">â†‘ ãƒˆãƒƒãƒ—ã¸</button>

  <audio id="beep" src="https://freesound.org/data/previews/341/341695_5260877-lq.mp3"></audio>

  <script>
    let startTime, timerInterval, targetTime = 10;
    let bestDiff = null;
    let history = [];
    let showTime = true;

    const timeDisplay = document.getElementById('time');
    const resultDisplay = document.getElementById('result');
    const bestDisplay = document.getElementById('best');
    const historyList = document.getElementById('historyList');
    const startBtn = document.getElementById('start');
    const stopBtn = document.getElementById('stop');
    const gameArea = document.getElementById('gameArea');
    const modeSelect = document.getElementById('modeSelect');
    const displaySelect = document.getElementById('displaySelect');
    const targetLabel = document.getElementById('targetLabel');
    const countdown = document.getElementById('countdown');
    const beep = document.getElementById('beep');
    const toTop = document.getElementById('toTop');

    function selectTarget(seconds) {
      targetTime = seconds;
      modeSelect.style.display = 'none';
      displaySelect.style.display = 'block';
    }

    function selectDisplayMode(show) {
      showTime = show;
      displaySelect.style.display = 'none';
      gameArea.style.display = 'block';
      targetLabel.textContent = `ç›®æ¨™ï¼š${targetTime}ç§’ãƒ”ãƒƒã‚¿ãƒªã§æ­¢ã‚ã‚ˆã†ï¼`;

      const bestKey = `bestDiff_${targetTime}_${showTime}`;
      const historyKey = `history_${targetTime}_${showTime}`;
      bestDiff = localStorage.getItem(bestKey);
      history = JSON.parse(localStorage.getItem(historyKey)) || [];

      bestDisplay.textContent = bestDiff
        ? `ãƒ™ã‚¹ãƒˆè¨˜éŒ²: èª¤å·® ${parseFloat(bestDiff).toFixed(2)} ç§’`
        : `ãƒ™ã‚¹ãƒˆè¨˜éŒ²: ãªã—`;

      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      historyList.innerHTML = '';
      history.forEach((entry, index) => {
        const li = document.createElement('li');
        li.textContent = `${index + 1}. ${entry.time.toFixed(2)} ç§’ï¼ˆèª¤å·® ${entry.diff.toFixed(2)} ç§’ï¼‰`;
        historyList.appendChild(li);
      });
    }

    function startCountdown(callback) {
      let count = 3;
      countdown.textContent = count;
      beep.play();
      const countdownInterval = setInterval(() => {
        count--;
        if (count > 0) {
          countdown.textContent = count;
          beep.play();
        } else {
          clearInterval(countdownInterval);
          countdown.textContent = 'ã‚¹ã‚¿ãƒ¼ãƒˆï¼';
          beep.play();
          setTimeout(() => {
            countdown.textContent = '';
            callback();
          }, 500);
        }
      }, 1000);
    }

    function startTimer() {
      if (!showTime) {
        timeDisplay.style.visibility = 'hidden';
      } else {
        timeDisplay.style.visibility = 'visible';
      }

      startTime = Date.now();
      timerInterval = setInterval(() => {
        const elapsed = (Date.now() - startTime) / 1000;
        timeDisplay.textContent = elapsed.toFixed(2);
      }, 10);
      stopBtn.disabled = false;
    }

    startBtn.addEventListener('click', () => {
      startBtn.disabled = true;
      stopBtn.disabled = true;
      resultDisplay.textContent = '';
      timeDisplay.textContent = '0.00';
      startCountdown(startTimer);
    });

    stopBtn.addEventListener('click', () => {
      clearInterval(timerInterval);
      const finalTime = (Date.now() - startTime) / 1000;
      const diff = Math.abs(finalTime - targetTime);
      timeDisplay.textContent = finalTime.toFixed(2);
      timeDisplay.style.visibility = 'visible';
      resultDisplay.textContent = `çµæœ: ${finalTime.toFixed(2)} ç§’ï¼ˆèª¤å·® ${diff.toFixed(2)} ç§’ï¼‰`;

      const bestKey = `bestDiff_${targetTime}_${showTime}`;
      const historyKey = `history_${targetTime}_${showTime}`;

      if (bestDiff === null || diff < parseFloat(bestDiff)) {
        bestDiff = diff;
        localStorage.setItem(bestKey, bestDiff);
        bestDisplay.textContent = `ãƒ™ã‚¹ãƒˆè¨˜éŒ²: èª¤å·® ${diff.toFixed(2)} ç§’ ğŸ‰`;
      }

      history.unshift({ time: finalTime, diff: diff });
      if (history.length > 10) history.pop();
      localStorage.setItem(historyKey, JSON.stringify(history));
      updateHistoryDisplay();

      startBtn.disabled = false;
      stopBtn.disabled = true;
    });

    // ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    window.addEventListener('scroll', () => {
      if (window.scrollY > 200) {
        toTop.style.display = 'block';
      } else {
        toTop.style.display = 'none';
      }
    });

    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
